trigger:
- none

variables:
  DeploymentPath: 'C:\Deployments\AzureTestProject'

resources:
  pipelines:
    - pipeline: 'buildPipeline'
      project: 'AzureTestProject'
      source: 'Build pipeline'
      branch: 'main'

stages:
  - stage: DeployWebsite
    displayName: 'Deploy website'
    pool:
      vmImage: windows-latest

    jobs:
    - deployment: DeployWebsite
      displayName: 'Deploy website'
      environment: 'Windows 11 server.DESLAB-052'
      strategy:
        runOnce:
          deploy:
            steps:
              - checkout: none

              - download: 'buildPipeline'
                name: 'DownloadBuildArtifacts'
                displayName: 'Download Build Artifacts'
                artifact: 'AzureTestProject'

              - script: |
                  echo "Deploying application..."
                  New-Item -ItemType Directory -Path "${{ variables.DeploymentPath }}" -Force
                  Copy-Item "$(Pipeline.Workspace)\buildPipeline\AzureTestProject\*" "${{ variables.DeploymentPath }}" -Recurse -Force
                  echo "Deployment complete."
                displayName: 'Copy Build Artifacts to Deployment Directory'
                workingDirectory: $(Pipeline.Workspace)

Starting: Copy Build Artifacts to Deployment Directory
==============================================================================
Task         : Command line
Description  : Run a command line script using Bash on Linux and macOS and cmd.exe on Windows
Version      : 2.250.1
Author       : Microsoft Corporation
Help         : https://docs.microsoft.com/azure/devops/pipelines/tasks/utility/command-line
==============================================================================
Generating script.
========================== Starting Command Output ===========================
"C:\Windows\system32\cmd.exe" /D /E:ON /V:OFF /S /C "CALL "C:\azagent\A2\_work\_temp\d8f076c6-1ff4-4de6-baad-9f25f8c94cec.cmd""
"Deploying application..."
'New-Item' is not recognized as an internal or external command,
operable program or batch file.
'Copy-Item' is not recognized as an internal or external command,
operable program or batch file.
"Deployment complete."
##[error]Cmd.exe exited with code '9009'.
Finishing: Copy Build Artifacts to Deployment Directory
